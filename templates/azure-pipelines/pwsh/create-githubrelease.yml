steps:
- pwsh: |
    $ErrorActionPreference = 'Stop'
    $VerbosePreference = 'Continue'
    Set-StrictMode -Version Latest
    Import-Module .\build\PSRepositoryReleaseManager\src\PSRepositoryReleaseManager\PSRepositoryReleaseManager.psm1
    Import-Module .\build\PSRepositoryReleaseManager\lib\PSGitHubRestApi\src\PSGitHubRestApi\PSGitHubRestApi.psm1
    $releaseBody = ..\build\PSRepositoryReleaseManager\src\scripts\Invoke-Generate.ps1 -Path $(Get-Location) -TagName $env:RELEASE_TAG_REF -Variant DateCommitHistory
    .\build\PSRepositoryReleaseManager\src\scripts\Invoke-Release.ps1 -Namespace $env:RELEASE_NAMESPACE -Repository $env:RELEASE_REPOSITORY -ApiKey $env:GITHUB_API_TOKEN -TagName $env:RELEASE_TAG_REF -ReleaseBody $releaseBody > $null
  displayName: Create GitHub release
  condition: and(startsWith(variables['Build.SourceBranch'], 'refs/tags/'), ne(variables['RELEASE_TAG_REF'], ''))
  env:
    GITHUB_API_TOKEN: $(GITHUB_API_TOKEN)
